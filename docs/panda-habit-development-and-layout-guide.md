# PandaHabit 开发与布局规范指南

## 1. 项目概述

PandaHabit是一款基于华丽游戏风格的习惯养成应用，通过熊猫伙伴、任务系统、反思模块等功能帮助用户建立和维持良好习惯。项目采用React + TypeScript开发，支持多语言，并具有离线使用能力。

### 1.1 设计原则

1. **华丽游戏风格**：所有界面元素采用东方美学与现代游戏设计相结合的方式
2. **水墨画风格图标**：图标体现留白、笔触变化、墨色渐变和自然流动感
3. **骨架屏加载**：所有页面实现骨架屏加载功能，提供平滑的视觉过渡
4. **多语言支持**：所有页面和组件支持中英文切换
5. **传统窗棂样式**：弹窗组件采用传统窗棂样式设计

### 1.2 技术架构

- **前端框架**：React + TypeScript
- **状态管理**：React Context API
- **路由**：React Router
- **动画**：Framer Motion
- **本地存储**：Dexie.js (IndexedDB)
- **样式**：Tailwind CSS
- **构建工具**：Vite

## 2. iOS游戏设计核心原则

参考苹果游戏设计指南，我们采用以下核心原则：

### 2.1 专注于核心游戏体验

- **简化界面**：减少不必要的UI元素，让用户专注于核心游戏体验
- **直观交互**：确保交互方式直观且符合用户预期
- **视觉层次**：建立清晰的视觉层次，突出重要元素
- **一致性**：保持界面元素和交互方式的一致性

### 2.2 iOS游戏设计特有原则

- **设备适应性**：考虑用户可能在旅行、办公桌前、沙发上或站立时使用应用
- **硬件利用**：充分利用高分辨率显示屏、Apple芯片性能和触控功能
- **触控优先**：iPhone和iPad应用应以触控为主要交互方式
- **物理反馈**：使用触觉反馈匹配应用中的重要事件
- **环境适应**：考虑用户所处环境（明亮、黑暗、嘈杂、安静）对体验的影响

### 2.3 安全区域与布局

遵循苹果设备的安全区域指南：

- **边缘安全区域**：确保重要内容和交互元素不被设备边缘、刘海或动态岛遮挡
- **底部安全区域**：为底部手势预留足够空间（至少44pt）
- **顶部安全区域**：为状态栏和刘海区域预留空间

### 2.4 间距规范

为确保视觉一致性，应使用以下标准间距：

- **紧凑间距**：8pt（适用于相关元素之间）
- **标准间距**：16pt（适用于组件内部元素）
- **宽松间距**：24pt（适用于主要内容区块之间）
- **分隔间距**：32pt（适用于不同功能区域之间）

所有元素间距应使用这些标准值的倍数，不应使用任意值。

## 3. 布局结构问题分析

当前实现中存在严重的布局结构问题，这些问题会影响用户体验和应用的专业性：

### 3.1 布局不一致

- 各页面之间的布局结构不一致，缺乏统一的设计语言
- 页面元素排列混乱，缺乏清晰的视觉层次
- 间距和对齐不规范，造成视觉混乱
- **解决方案**：制定统一的布局规范并应用到所有页面 (优先级: P0)

### 3.2 响应式问题

- 多数页面在不同屏幕尺寸下显示异常
- 元素重叠或错位现象严重
- 内容溢出容器边界
- **解决方案**：修复所有页面的响应式布局 (优先级: P1)

### 3.3 导航结构混乱

- 导航层次不清晰，用户难以理解页面之间的关系
- 返回路径不一致，造成用户困惑
- 缺少面包屑或其他导航辅助元素
- **解决方案**：重新设计导航结构和交互模式 (优先级: P1)

### 3.4 内容密度问题

- 部分页面内容过于密集，缺乏适当的留白
- 其他页面则内容过于稀疏，浪费屏幕空间
- 信息层次不明确，重要内容没有突出显示
- **解决方案**：优化所有页面的内容密度和信息层次 (优先级: P1)

## 4. 游戏界面结构规范

### 4.1 游戏界面层次

根据苹果游戏设计指南，我们将界面分为以下层次：

1. **游戏世界层**：展示熊猫和主要游戏环境
2. **HUD层**：显示资源、状态和关键信息
3. **交互层**：提供主要交互按钮和控件
4. **菜单层**：提供导航和设置选项
5. **弹出层**：显示临时信息和交互

### 4.2 屏幕布局区域

将屏幕划分为以下功能区域：

```
+----------------------------------+
|        状态区（资源显示）        |
+----------------------------------+
|                                  |
|        主要内容/游戏区域         |
|        (熊猫互动/任务展示)       |
|                                  |
+----------------------------------+
|          主要交互区域            |
+----------------------------------+
|            导航区域              |
+----------------------------------+
```

### 4.3 内容区域布局模式

根据功能需求，选择以下布局模式之一：

1. **焦点模式**：突出单个主要元素（如熊猫展示）
2. **卡片流模式**：适用于任务列表、成就展示等
3. **网格模式**：适用于皮肤选择、能力展示等
4. **分屏模式**：适用于需要对比或并列显示的内容
5. **沉浸模式**：适用于反思、心情记录等需要专注的功能

## 5. 页面特定布局指南

### 5.1 主页/家园（焦点模式）

**当前问题**：
- 熊猫展示区域缺乏清晰边界
- 资源指示器分散不一致
- 交互元素放置未考虑触及范围

**布局规范**：
- **游戏世界层**：熊猫展示区域占据屏幕中央60-70%的区域
- **HUD层**：
  - 资源显示位于顶部安全区域内，采用水平排列
  - 使用图标+数值的组合，确保清晰可读
- **交互层**：
  - 主要互动按钮围绕熊猫展示区域排列，形成环形或半环形布局
  - 每个按钮至少44pt×44pt，间距至少16pt
- **状态层**：
  - 任务进度显示在底部导航栏上方
  - 使用视觉指示器显示当前状态

### 5.2 任务列表页（卡片流模式）

**当前问题**：
- 筛选选项占用过多垂直空间
- 任务卡片尺寸不一致
- 添加任务按钮位置变化

**布局规范**：
- **导航区**：
  - 页面标题和返回按钮位于顶部安全区域
  - 筛选器位于标题下方，采用水平滚动卡片式设计
- **内容区**：
  - 任务列表采用垂直滚动的卡片流布局
  - 每个任务卡片高度一致，间距为16pt
  - 任务卡片包含图标、名称、描述、截止日期和状态指示器
- **交互区**：
  - 添加任务按钮固定在右下角，距离边缘16pt，直径至少60pt
  - 支持滑动手势完成或编辑任务

### 5.3 熊猫互动/详情页（分屏模式）

**当前问题**：
- 熊猫视图与交互选项之间的分隔不明确
- 标签导航实现不一致
- 详情部分缺乏结构

**布局规范**：
- **上半部分**：
  - 熊猫展示区域占据屏幕上半部分（约60%）
  - 使用3D效果和动画增强沉浸感
  - 互动按钮围绕熊猫排列，使用图标+文字组合
- **下半部分**：
  - 标签页导航位于分界线处，使用水平滑动切换
  - 详情内容采用卡片布局，支持垂直滚动
  - 每个标签页内容保持一致的视觉风格

### 5.4 心情打卡/反思模块（沉浸模式）

**当前问题**：
- 心情选择UI缺乏清晰的视觉结构
- 输入区域尺寸不一致
- 历史视图实现各异

**布局规范**：
- **顶部区域**：
  - 心情选择器采用水平排列的大图标设计
  - 每个心情图标至少60pt×60pt，间距16pt
  - 当前选中状态有明确视觉反馈
- **中部区域**：
  - 反思输入区域采用卷轴或古籍设计
  - 输入框高度自适应，最小高度120pt
  - 提供字数统计和提示信息
- **底部区域**：
  - 历史记录采用时间线布局，支持水平滑动查看
  - 提交按钮位于输入区域下方，宽度至少200pt

### 5.5 个人资料/设置页（网格模式）

**当前问题**：
- 用户信息部分缺乏视觉突出性
- 设置组混在一起
- 成就显示不一致

**布局规范**：
- **顶部区域**：
  - 用户信息卡片占据屏幕宽度的90%
  - 包含头像、用户名、等级和简介
  - 使用游戏风格装饰元素增强视觉效果
- **中部区域**：
  - 统计数据采用2×2或3×2网格布局
  - 每个统计项使用图标+数值+标签组合
  - 网格间距为16pt，内边距为16pt
- **底部区域**：
  - 成就展示采用水平滚动卡片布局，每页显示2-3个
  - 设置项采用分组列表布局，组间距为24pt
  - 每个设置项高度至少60pt，包含图标、标题和控件

## 6. 实施计划

### 6.1 第一阶段（当前）

**重点**：布局规范和高优先级页面

1. 创建布局规范文档和基础布局组件库
2. 修复主要页面的布局结构问题
3. 创建水墨画风格图标库基础组件和常用图标
4. 优化传统窗棂样式弹窗组件
5. 完成心情打卡/反思模块的实现
6. 开始个人资料/设置页的实现

### 6.2 第二阶段（2-3周）

**重点**：完善页面样式和响应式布局

1. 完成所有页面的响应式布局优化
2. 完成个人资料/设置页的实现
3. 完成熊猫互动/详情页的样式更新
4. 创建华丽游戏风格UI元素
5. 开始VIP特权总览页和订阅选择页的实现
6. 完成所有页面的图标替换

### 6.3 第三阶段（3-4周）

**重点**：缺失页面和细节优化

1. 完成所有缺失页面的实现
2. 实现水墨扩散动画效果
3. 优化所有页面的细节和交互
4. 进行全面测试和调整

## 7. 布局实现检查清单

在完成页面实现后，使用以下清单进行检查：

### 7.1 基础检查项

- [ ] 界面是否遵循游戏层次结构？（世界层、HUD层、交互层等）
- [ ] 所有交互元素是否有足够大的点击区域？（至少44pt×44pt）
- [ ] 内容是否位于安全区域内？（避免刘海、动态岛等遮挡）
- [ ] 是否为所有交互提供了明确的视觉反馈？
- [ ] 界面在所有支持的设备和方向上是否正确显示？

### 7.2 iOS特有检查项

- [ ] 是否遵循iOS人机界面指南？
- [ ] 触控区域是否符合iOS标准（至少44pt×44pt）？
- [ ] 是否支持iOS系统手势（如返回手势）？
- [ ] 是否适配所有目标iPhone屏幕尺寸？
- [ ] 是否支持iOS深色模式？

### 7.3 布局混乱修复检查项

- [ ] 元素是否按照4pt基础网格对齐？
- [ ] 间距是否使用标准值（8pt, 16pt, 24pt, 32pt）？
- [ ] 相关元素是否正确分组？
- [ ] 视觉层次是否清晰？
- [ ] 页面是否避免过度拥挤？

## 8. 相关文档

- [设计与实现对齐计划](design-implementation-alignment-plan.md)
- [布局规范指南](layout-guidelines.md)
- [iOS移动应用设计指南](ios-mobile-app-design-guidelines.md)
- [PandaHabit iOS布局实现指南](pandahabit-ios-layout-implementation-guide.md)
- [苹果游戏设计原则摘要](apple-game-design-principles-summary.md)
