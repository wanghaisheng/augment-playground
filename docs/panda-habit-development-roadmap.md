# PandaHabit 开发路线图

本文档整合了PandaHabit项目的所有开发任务、进度和计划，作为项目开发的主要参考文档。

## 1. 项目概述

PandaHabit是一款基于华丽游戏风格的习惯养成应用，通过熊猫伙伴、任务系统、反思模块等功能帮助用户建立和维持良好习惯。项目采用React + TypeScript开发，支持多语言，并具有离线使用能力。

### 1.1 设计原则

1. **华丽游戏风格**：所有界面元素采用东方美学与现代游戏设计相结合的方式
2. **水墨画风格图标**：图标体现留白、笔触变化、墨色渐变和自然流动感
3. **骨架屏加载**：所有页面实现骨架屏加载功能，提供平滑的视觉过渡
4. **多语言支持**：所有页面和组件支持中英文切换
5. **传统窗棂样式**：弹窗组件采用传统窗棂样式设计

### 1.2 技术架构

- **前端框架**：React + TypeScript
- **状态管理**：React Context API
- **路由**：React Router
- **动画**：Framer Motion
- **本地存储**：Dexie.js (IndexedDB)
- **样式**：Tailwind CSS
- **构建工具**：Vite

## 2. 已完成任务

### 2.1 组件迁移与整理

#### 2.1.1 组件评估与废弃

| ID | 任务 | 状态 | 完成时间 |
|----|------|------|---------|
| 2.1.1.1 | 创建`src/components/deprecated`目录 | ✅ 已完成 | 2023-11-15 |
| 2.1.1.2 | 评估所有带有"optimized"、"enhanced"前缀的组件 | ✅ 已完成 | 2023-11-15 |
| 2.1.1.3 | 评估所有带有"Next"后缀的组件 | ✅ 已完成 | 2023-11-15 |
| 2.1.1.4 | 创建组件迁移计划文档 | ✅ 已完成 | 2023-11-15 |

#### 2.1.2 核心组件迁移

| ID | 任务 | 状态 | 完成时间 |
|----|------|------|---------|
| 2.1.2.1 | 迁移`Button`到`EnhancedAnimatedButton` | ✅ 已完成 | 2023-11-15 |
| 2.1.2.2 | 更新`AnimatedButton`使用`EnhancedAnimatedButton` | ✅ 已完成 | 2023-11-15 |
| 2.1.2.3 | 迁移`TextArea`到`EnhancedTextArea` | ✅ 已完成 | 2023-11-15 |
| 2.1.2.4 | 迁移`AnimatedItem`到`OptimizedAnimatedItem` | ✅ 已完成 | 2023-11-15 |
| 2.1.2.5 | 迁移`PageTransition`到`EnhancedPageTransition` | ✅ 已完成 | 2023-11-15 |
| 2.1.2.6 | 迁移`ReflectionModule`到`EnhancedReflectionModule` | ✅ 已完成 | 2023-11-15 |

#### 2.1.3 功能组件迁移

| ID | 任务 | 状态 | 完成时间 |
|----|------|------|---------|
| 2.1.3.1 | 迁移`AnimatedContainer`到`OptimizedAnimatedContainer` | ✅ 已完成 | 2023-11-15 |
| 2.1.3.2 | 迁移`InkAnimation`到`OptimizedInkAnimation` | ✅ 已完成 | 2023-11-15 |
| 2.1.3.3 | 迁移`DataLoader`到`EnhancedDataLoader` | ✅ 已完成 | 2023-11-15 |
| 2.1.3.4 | 迁移任务相关组件 | ✅ 已完成 | 2023-11-15 |
| 2.1.3.5 | 迁移反思相关组件 | ✅ 已完成 | 2023-11-15 |
| 2.1.3.6 | 迁移熊猫相关组件 | ✅ 已完成 | 2023-11-15 |

### 2.2 通用组件实现

#### 2.2.1 传统窗棂样式弹窗

| ID | 任务 | 状态 | 完成时间 |
|----|------|------|---------|
| 2.2.1.1 | 创建`src/components/common/TraditionalWindowModal.tsx` | ✅ 已完成 | 2023-11-15 |
| 2.2.1.2 | 创建`src/components/common/TraditionalWindowModalProvider.tsx` | ✅ 已完成 | 2023-11-15 |
| 2.2.1.3 | 创建`src/hooks/useTraditionalWindowModal.tsx` | ✅ 已完成 | 2023-11-15 |

### 2.3 页面实现

#### 2.3.1 熊猫互动/详情页

| ID | 任务 | 状态 | 完成时间 |
|----|------|------|---------|
| 2.3.1.1 | 创建`src/components/panda/PandaStatusTab.tsx` | ✅ 已完成 | 2023-11-15 |
| 2.3.1.2 | 创建`src/components/panda/PandaSkinTab.tsx` | ✅ 已完成 | 2023-11-15 |
| 2.3.1.3 | 创建`src/components/panda/PandaInteractionTab.tsx` | ✅ 已完成 | 2023-11-15 |
| 2.3.1.4 | 创建`src/pages/PandaInteractionPage.tsx` | ✅ 已完成 | 2023-11-15 |
| 2.3.1.5 | 更新路由配置 | ✅ 已完成 | 2023-11-15 |

## 3. 设计与实现差距分析

### 3.1 设计文件分析

`input\screens`目录包含了详细的UI设计CSV文件，这些文件定义了每个页面的节点结构、位置、尺寸、样式和AI图像生成提示。主要设计文件包括：

1. **闪屏页 (splash_screen.csv)**：应用启动时显示的第一个界面
2. **引导页 (onboarding_screen.csv)**：新用户首次使用应用时的引导页面
3. **登录/注册页 (login_register_screen.csv)**：用户登录和注册的界面
4. **熊猫初始设置页 (panda_setup_screen.csv)**：用户首次登录后设置熊猫的界面
5. **主页/家园 (home_page.csv)**：应用的主界面，显示熊猫、准时进度条、互动按钮和任务引导
6. **任务列表页 (task_list_page.csv)**：显示所有任务的列表页面
7. **熊猫互动/详情页 (panda_interaction_page.csv)**：与熊猫互动和查看熊猫详细信息的页面
8. **心情打卡/反思模块 (mood_check_page.csv)**：用于记录心情和反思的页面
9. **个人资料/设置页 (profile_page.csv)**：显示用户信息和应用设置的页面
10. **VIP特权总览页 (vip_benefits_page.csv)**：展示VIP特权和价值的页面
11. **订阅选择页 (subscription_page.csv)**：选择VIP订阅计划的页面

### 3.2 实现差距分析

通过对比`input\screens`目录中的设计文件和当前实现，我们发现以下主要差距：

#### 3.2.1 主页/家园 (HomePage)

**设计要求**：
- 水墨画风格图标和按钮
- 熊猫展示区域应有流畅的动画效果和互动反馈
- 资源显示部分应采用传统中国风格的计数器样式
- 所有弹窗应使用传统窗棂样式
- 背景应有淡雅的水墨风格纹理

**当前实现差距**：
- 使用了普通图标而非水墨画风格
- 熊猫动画效果简单，缺乏丰富的互动反馈
- 资源显示使用了标准UI组件，缺乏中国风特色
- 弹窗使用了标准样式，未实现窗棂设计
- 背景较为简单，缺少设计文档中指定的纹理

**具体任务**：
- 实现水墨画风格图标库 (优先级: P1)
- 增强熊猫动画效果，添加更多互动反馈 (优先级: P2)
- 重新设计资源显示组件，采用中国风计数器样式 (优先级: P2)
- 将所有弹窗更新为传统窗棂样式 (优先级: P1)
- 添加水墨风格背景纹理 (优先级: P3)

#### 3.2.2 任务列表页 (TasksPage)

**设计要求**：
- 筛选器应采用卷轴式设计
- 任务卡片应有华丽游戏风格边框和装饰元素
- 所有图标应为水墨画风格
- 添加任务按钮应采用印章样式
- 任务完成动画应有水墨扩散效果

**当前实现差距**：
- 筛选器使用了标准下拉菜单，缺乏设计特色
- 任务卡片样式简单，缺少华丽游戏风格元素
- 使用了标准图标而非水墨画风格
- 添加任务按钮使用了标准浮动按钮样式
- 任务完成动画简单，缺乏水墨效果

**具体任务**：
- 重新设计筛选器组件，实现卷轴式设计 (优先级: P2)
- 更新任务卡片样式，添加华丽游戏风格边框和装饰 (优先级: P1)
- 替换所有图标为水墨画风格 (优先级: P1)
- 重新设计添加任务按钮，实现印章样式 (优先级: P2)
- 实现水墨扩散效果的任务完成动画 (优先级: P2)

#### 3.2.3 熊猫互动/详情页 (PandaInteractionPage)

**设计要求**：
- 页面应采用竹简卷轴式布局
- 熊猫互动应有丰富的动画效果和粒子特效
- 互动按钮应采用中国传统印章样式
- 熊猫状态展示应使用传统中国风格的仪表盘
- 皮肤选择界面应有华丽的展示效果

**当前实现差距**：
- 页面使用了标准卡片布局，缺乏卷轴式设计
- 熊猫互动动画效果简单，缺乏粒子特效
- 互动按钮使用了标准样式，缺乏印章特色
- 状态展示使用了标准进度条，缺乏中国风特色
- 皮肤选择界面简单，缺乏华丽展示效果

**具体任务**：
- 重新设计页面布局，实现竹简卷轴式设计 (优先级: P2)
- 增强熊猫互动动画效果，添加粒子特效 (优先级: P1)
- 重新设计互动按钮，实现印章样式 (优先级: P2)
- 更新状态展示组件，采用中国风仪表盘样式 (优先级: P2)
- 优化皮肤选择界面，添加华丽展示效果 (优先级: P3)

#### 3.2.4 心情打卡/反思模块 (MoodCheckPage)

**设计要求**：
- 页面应采用茶室风格布局，有茶杯和茶具装饰
- 心情选择器应采用水墨画风格的表情图标
- 反思输入组件应采用古籍书页样式
- 历史记录应采用卷轴式展示
- 提交按钮应有水墨扩散动画效果

**当前实现差距**：
- 当前使用`TeaRoomPage`，但缺乏茶室风格装饰元素
- 心情选择器使用了标准表情图标，缺乏水墨画风格
- 反思输入组件使用了标准文本框，缺乏古籍书页样式
- 历史记录使用了标准列表，缺乏卷轴式展示效果
- 提交按钮动画简单，缺乏水墨扩散效果

**具体任务**：
- 重构`TeaRoomPage`为`MoodCheckPage`，添加茶室风格装饰 (优先级: P1)
- 创建水墨画风格的心情选择器组件 (优先级: P1)
- 重新设计反思输入组件，实现古籍书页样式 (优先级: P2)
- 实现卷轴式历史记录展示 (优先级: P2)
- 添加水墨扩散动画效果到提交按钮 (优先级: P3)

#### 3.2.5 缺失页面分析

根据设计文件，以下页面尚未完全实现或与设计有较大差距：

1. **个人资料/设置页**：
   - 设计要求采用古籍档案风格，当前实现为标准设置页
   - 缺少成就展示和统计数据可视化部分
   - 任务：创建符合设计的个人资料页 (优先级: P1)

2. **VIP特权总览页**：
   - 设计要求采用华丽卷轴展示，当前实现较为简单
   - 缺少动态特效和价值展示
   - 任务：重新设计VIP特权页面 (优先级: P2)

3. **订阅选择页**：
   - 设计要求采用古代钱币和印章元素，当前实现为标准订阅页
   - 缺少动画效果和礼品展示
   - 任务：创建符合设计的订阅选择页 (优先级: P2)

4. **通知中心/消息页**：
   - 设计要求采用竹简信件风格，当前实现为标准消息列表
   - 缺少动画效果和分类展示
   - 任务：创建符合设计的通知中心页 (优先级: P2)

## 4. 进行中任务

### 4.1 页面实现与更新

#### 4.1.1 心情打卡/反思模块

| ID | 任务 | 优先级 | 状态 | 依赖 | 估计工时(小时) |
|----|------|--------|------|------|---------------|
| 4.1.1.1 | 重构`TeaRoomPage`为`MoodCheckPage` | P1 | 进行中 | 无 | 8 |
| 4.1.1.2 | 创建`src/components/mood/MoodSelector.tsx` | P1 | 进行中 | 无 | 4 |
| 4.1.1.3 | 创建`src/components/mood/ReflectionInput.tsx` | P1 | 待开始 | 无 | 4 |
| 4.1.1.4 | 创建`src/components/mood/MoodHistory.tsx` | P1 | 待开始 | 无 | 4 |
| 4.1.1.5 | 更新路由配置 | P1 | 待开始 | 4.1.1.1 | 1 |

#### 4.1.2 个人资料/设置页

| ID | 任务 | 优先级 | 状态 | 依赖 | 估计工时(小时) |
|----|------|--------|------|------|---------------|
| 4.1.2.1 | 创建`src/components/profile/UserInfoSection.tsx` | P1 | 待开始 | 无 | 3 |
| 4.1.2.2 | 创建`src/components/profile/UserStatsSection.tsx` | P1 | 待开始 | 无 | 3 |
| 4.1.2.3 | 创建`src/components/profile/AchievementsSection.tsx` | P1 | 待开始 | 无 | 4 |
| 4.1.2.4 | 更新`src/pages/SettingsPage.tsx` | P1 | 待开始 | 4.1.2.1-4.1.2.3 | 6 |
| 4.1.2.5 | 创建`src/pages/ProfilePage.tsx` | P1 | 待开始 | 4.1.2.1-4.1.2.3 | 6 |
| 4.1.2.6 | 更新路由配置 | P1 | 待开始 | 4.1.2.4, 4.1.2.5 | 1 |

### 4.2 通用组件实现

#### 4.2.1 水墨画风格图标

| ID | 任务 | 优先级 | 状态 | 依赖 | 估计工时(小时) |
|----|------|--------|------|------|---------------|
| 4.2.1.1 | 创建`src/components/icons/InkWashIcon.tsx` | P2 | 待开始 | 无 | 4 |
| 4.2.1.2 | 创建常用图标的水墨画风格版本 | P2 | 待开始 | 4.2.1.1 | 12 |
| 4.2.1.3 | 更新现有组件使用水墨画风格图标 | P3 | 待开始 | 4.2.1.1, 4.2.1.2 | 8 |

#### 4.2.2 骨架屏组件

| ID | 任务 | 优先级 | 状态 | 依赖 | 估计工时(小时) |
|----|------|--------|------|------|---------------|
| 4.2.2.1 | 创建`src/components/skeleton/MoodCheckPageSkeleton.tsx` | P2 | 待开始 | 无 | 3 |
| 4.2.2.2 | 创建`src/components/skeleton/ProfilePageSkeleton.tsx` | P2 | 待开始 | 无 | 3 |

## 5. 待开始任务

### 5.1 页面实现与更新

#### 5.1.1 订阅选择页

| ID | 任务 | 优先级 | 状态 | 依赖 | 估计工时(小时) |
|----|------|--------|------|------|---------------|
| 5.1.1.1 | 创建`src/components/subscription/SubscriptionPlanCard.tsx` | P2 | 待开始 | 无 | 4 |
| 5.1.1.2 | 创建`src/components/subscription/BonusGiftSection.tsx` | P2 | 待开始 | 无 | 3 |
| 5.1.1.3 | 创建`src/pages/SubscriptionPage.tsx` | P2 | 待开始 | 5.1.1.1, 5.1.1.2 | 6 |
| 5.1.1.4 | 更新路由配置 | P2 | 待开始 | 5.1.1.3 | 1 |

#### 5.1.2 通知中心/消息页

| ID | 任务 | 优先级 | 状态 | 依赖 | 估计工时(小时) |
|----|------|--------|------|------|---------------|
| 5.1.2.1 | 创建`src/components/notification/SystemNotificationList.tsx` | P2 | 待开始 | 无 | 4 |
| 5.1.2.2 | 创建`src/components/notification/MessageList.tsx` | P2 | 待开始 | 无 | 4 |
| 5.1.2.3 | 创建`src/pages/NotificationPage.tsx` | P2 | 待开始 | 5.1.2.1, 5.1.2.2 | 6 |
| 5.1.2.4 | 更新路由配置 | P2 | 待开始 | 5.1.2.3 | 1 |

#### 5.1.3 帮助与反馈/FAQ页

| ID | 任务 | 优先级 | 状态 | 依赖 | 估计工时(小时) |
|----|------|--------|------|------|---------------|
| 5.1.3.1 | 创建`src/components/help/FAQItem.tsx` | P3 | 待开始 | 无 | 2 |
| 5.1.3.2 | 创建`src/components/help/FAQList.tsx` | P3 | 待开始 | 5.1.3.1 | 3 |
| 5.1.3.3 | 创建`src/components/help/FeedbackForm.tsx` | P3 | 待开始 | 无 | 4 |
| 5.1.3.4 | 创建`src/pages/HelpPage.tsx` | P3 | 待开始 | 5.1.3.1-5.1.3.3 | 6 |
| 5.1.3.5 | 更新路由配置 | P3 | 待开始 | 5.1.3.4 | 1 |

### 5.2 通用组件更新

| ID | 任务 | 优先级 | 状态 | 依赖 | 估计工时(小时) |
|----|------|--------|------|------|---------------|
| 5.2.1 | 更新现有弹窗使用传统窗棂样式 | P2 | 待开始 | 2.2.1.1-2.2.1.3 | 8 |

## 6. 实施计划

> **注意**：更详细的设计与实现对齐计划请参考 [设计与实现对齐计划](design-implementation-alignment-plan.md) 文档。

### 6.1 第一阶段（当前）

**重点**：基础组件和高优先级页面

1. 创建水墨画风格图标库基础组件和常用图标
2. 优化传统窗棂样式弹窗组件
3. 完成心情打卡/反思模块的实现
4. 开始个人资料/设置页的实现
5. 更新主页和任务列表页的关键样式

### 6.2 第二阶段（2-3周）

**重点**：完善页面样式和缺失页面

1. 完成个人资料/设置页的实现
2. 完成熊猫互动/详情页的样式更新
3. 创建华丽游戏风格UI元素
4. 开始VIP特权总览页和订阅选择页的实现
5. 完成所有页面的图标替换

### 6.3 第三阶段（3-4周）

**重点**：细节优化和动画效果

1. 完成所有缺失页面的实现
2. 实现水墨扩散动画效果
3. 优化所有页面的细节和交互
4. 进行全面测试和调整

## 7. 注意事项

### 7.1 代码质量

- 遵循TypeScript类型安全原则
- 避免使用any类型
- 使用React.memo优化渲染性能
- 遵循ESLint规则

### 7.2 多语言支持

- 确保所有用户可见文本都支持多语言
- 避免硬编码文本
- 使用useLocalizedView和useComponentLabels钩子获取多语言内容

### 7.3 UI一致性

- 遵循项目的华丽游戏风格
- 使用现有的设计元素和组件
- 保持与其他页面的视觉一致性

### 7.4 性能考虑

- 实现懒加载和代码分割
- 避免不必要的重渲染
- 使用DataRefreshProvider进行局部UI更新
- 支持离线使用

## 8. 技术债务与优化

### 8.1 TypeScript类型安全

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 8.1.1 | 修复组件props类型定义 | P1 | 进行中 | 8 |
| 8.1.2 | 修复服务层类型定义 | P1 | 进行中 | 8 |
| 8.1.3 | 移除any类型使用 | P2 | 待开始 | 12 |
| 8.1.4 | 实现严格的类型检查 | P2 | 待开始 | 8 |

### 8.2 多语言支持优化

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 8.2.1 | 修复硬编码文本 | P1 | 进行中 | 12 |
| 8.2.2 | 完善标签类型定义 | P2 | 待开始 | 6 |
| 8.2.3 | 优化标签加载性能 | P3 | 待开始 | 4 |

### 8.3 性能优化

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 8.3.1 | 实现组件懒加载 | P2 | 待开始 | 4 |
| 8.3.2 | 优化数据加载策略 | P2 | 待开始 | 8 |
| 8.3.3 | 实现离线数据同步 | P1 | 进行中 | 12 |

### 8.4 代码重构

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 8.4.1 | 重构服务层API | P3 | 待开始 | 16 |
| 8.4.2 | 统一错误处理机制 | P2 | 待开始 | 8 |
| 8.4.3 | 优化Context使用 | P2 | 待开始 | 6 |

## 9. 测试与质量保证

### 9.1 单元测试

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 9.1.1 | 为核心组件编写单元测试 | P2 | 待开始 | 16 |
| 9.1.2 | 为服务层编写单元测试 | P2 | 待开始 | 16 |
| 9.1.3 | 为工具函数编写单元测试 | P3 | 待开始 | 8 |

### 9.2 集成测试

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 9.2.1 | 为主要用户流程编写集成测试 | P2 | 待开始 | 16 |
| 9.2.2 | 为数据同步流程编写集成测试 | P2 | 待开始 | 12 |

### 9.3 性能测试

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 9.3.1 | 实现性能监控工具 | P3 | 待开始 | 8 |
| 9.3.2 | 进行性能基准测试 | P3 | 待开始 | 8 |

## 10. 部署与发布

### 10.1 构建优化

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 10.1.1 | 优化构建配置 | P2 | 待开始 | 4 |
| 10.1.2 | 实现代码分割 | P2 | 待开始 | 6 |
| 10.1.3 | 优化资源加载 | P2 | 待开始 | 6 |

### 10.2 发布流程

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 10.2.1 | 设置CI/CD流程 | P3 | 待开始 | 8 |
| 10.2.2 | 实现自动化测试 | P3 | 待开始 | 12 |
| 10.2.3 | 创建发布检查清单 | P3 | 待开始 | 4 |

## 11. 文档与知识库

### 11.1 开发文档

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 11.1.1 | 更新组件文档 | P2 | 进行中 | 8 |
| 11.1.2 | 更新API文档 | P2 | 待开始 | 8 |
| 11.1.3 | 创建架构文档 | P3 | 待开始 | 6 |

### 11.2 用户文档

| ID | 任务 | 优先级 | 状态 | 估计工时(小时) |
|----|------|--------|------|---------------|
| 11.2.1 | 创建用户指南 | P3 | 待开始 | 12 |
| 11.2.2 | 创建FAQ文档 | P3 | 待开始 | 8 |
| 11.2.3 | 创建视频教程 | P3 | 待开始 | 16 |

## 12. 项目管理

### 12.1 进度跟踪

- 每周更新本文档的任务状态
- 使用GitHub Issues跟踪具体任务
- 定期回顾和调整优先级

### 12.2 风险管理

- 定期评估技术风险
- 提前识别潜在瓶颈
- 制定应急计划

### 12.3 资源分配

- 根据优先级分配开发资源
- 平衡新功能开发和技术债务偿还
- 确保关键路径任务得到足够关注

## 13. 结论

本路线图将指导PandaHabit项目的开发，确保项目按计划推进，并保持高质量标准。随着项目的发展，路线图将定期更新以反映新的需求和优先级变化。
