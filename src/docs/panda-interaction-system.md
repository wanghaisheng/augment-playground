# 熊猫互动系统文档

## 概述

熊猫互动系统是 PandaHabit 应用中的核心功能之一，允许用户与虚拟熊猫伙伴进行各种互动，增强用户体验和参与度。本文档描述了熊猫互动系统的设计、实现和使用方法。

## 系统组件

熊猫互动系统由以下主要组件组成：

### 1. 熊猫状态管理

熊猫状态管理负责跟踪和更新熊猫的各种状态，包括：

- **心情**：熊猫的情绪状态，包括正常(normal)、开心(happy)、专注(focused)和疲惫(tired)。
- **能量**：熊猫的能量级别，包括高(high)、中(medium)和低(low)。
- **经验值**：熊猫的经验值，用于升级和解锁新能力。
- **等级**：熊猫的当前等级，影响可用的能力和互动。

相关文件：
- `src/context/PandaStateProvider.tsx`：熊猫状态上下文提供者
- `src/services/pandaStateService.ts`：熊猫状态服务

### 2. 熊猫互动服务

熊猫互动服务负责处理用户与熊猫的各种互动，包括：

- **互动类型**：定义了各种互动类型，如抚摸、喂食、玩耍等。
- **互动结果**：定义了互动的结果，包括经验值获取、心情变化等。
- **互动冷却**：管理互动的冷却时间，防止过度互动。
- **互动历史**：记录用户与熊猫的互动历史。

相关文件：
- `src/services/pandaInteractionService.ts`：熊猫互动服务

### 3. 熊猫动画组件

熊猫动画组件负责展示熊猫的各种动画效果，增强视觉体验：

- **基础动画**：熊猫的基础动画，如眨眼、伸懒腰等。
- **情绪动画**：熊猫的情绪动画，如开心、专注、疲惫等。
- **互动动画**：熊猫的互动动画，如抚摸、喂食、玩耍等。
- **粒子效果**：互动时的粒子效果，如心形、食物等。

相关文件：
- `src/components/game/PandaAnimation.tsx`：熊猫动画组件

### 4. 熊猫互动面板

熊猫互动面板是用户与熊猫互动的主要界面，提供了各种互动选项和反馈：

- **互动按钮**：提供各种互动选项，如抚摸、喂食、玩耍等。
- **互动结果**：显示互动的结果，如经验值获取、心情变化等。
- **互动统计**：显示用户与熊猫的互动统计信息。

相关文件：
- `src/components/panda/PandaInteractionPanel.tsx`：熊猫互动面板组件

## 互动类型

熊猫互动系统支持以下互动类型：

### 1. 抚摸 (Pet)

- **图标**：👋
- **效果**：提升熊猫心情，获得少量经验值。
- **冷却时间**：5秒
- **动画**：熊猫轻微摇晃，显示心形粒子效果。

### 2. 喂食 (Feed)

- **图标**：🍎
- **效果**：提升熊猫心情和能量，获得中量经验值。
- **冷却时间**：1分钟
- **动画**：熊猫进食动画，显示食物粒子效果。

### 3. 玩耍 (Play)

- **图标**：🎮
- **效果**：提升熊猫心情，消耗能量，获得较多经验值。
- **冷却时间**：2分钟
- **动画**：熊猫玩耍动画，显示欢快的动作。

### 4. 训练 (Train)

- **图标**：💪
- **效果**：熊猫进入专注状态，消耗能量，获得大量经验值。
- **冷却时间**：5分钟
- **动画**：熊猫训练动画，显示专注的表情。

### 5. 清洁 (Clean)

- **图标**：🧼
- **效果**：提升熊猫心情，获得少量经验值。
- **冷却时间**：10分钟
- **动画**：熊猫清洁动画，显示水滴效果。

### 6. 对话 (Talk)

- **图标**：💬
- **效果**：提升熊猫心情，获得少量经验值。
- **冷却时间**：30秒
- **动画**：熊猫对话动画，显示对话气泡。

### 7. 赠送礼物 (Gift)

- **图标**：🎁
- **效果**：大幅提升熊猫心情，获得大量经验值。
- **冷却时间**：1小时
- **动画**：熊猫开心动画，显示礼物盒和惊喜表情。

### 8. 拍照 (Photo)

- **图标**：📷
- **效果**：不改变熊猫状态，记录当前状态。
- **冷却时间**：1分钟
- **动画**：熊猫摆姿势动画，显示相机快门效果。

### 9. 睡觉 (Sleep)

- **图标**：😴
- **效果**：恢复熊猫能量，心情变为正常，获得中量经验值。
- **冷却时间**：8小时
- **动画**：熊猫睡觉动画，显示睡眠效果。

### 10. 唤醒 (Wake)

- **图标**：⏰
- **效果**：熊猫心情变为正常，获得少量经验值。
- **冷却时间**：无
- **动画**：熊猫醒来动画，显示伸展动作。

## 互动结果

每次互动都会产生一个互动结果，包含以下信息：

- **成功状态**：互动是否成功。
- **消息**：互动的结果消息。
- **经验值获取**：互动获得的经验值。
- **心情变化**：互动是否改变了熊猫的心情。
- **能量变化**：互动是否改变了熊猫的能量。
- **新心情**：互动后熊猫的新心情。
- **新能量**：互动后熊猫的新能量。
- **动画**：互动触发的动画。
- **音效**：互动触发的音效。
- **冷却时间**：互动的冷却时间。

## 互动冷却

为了防止用户过度互动，每种互动都有一个冷却时间。在冷却时间内，用户不能再次执行相同的互动。冷却时间的长短取决于互动的类型和影响。

## 互动历史

系统会记录用户与熊猫的互动历史，包括互动类型、时间、心情变化、能量变化和经验值获取等信息。用户可以在互动面板的统计标签页查看互动历史和统计信息。

## 多语言支持

熊猫互动系统支持多语言，包括中文和英文。所有的文本内容都通过 `useLocalizedView` 钩子获取，确保在不同语言环境下显示正确的文本。

## 使用方法

### 1. 初始化熊猫互动系统

在应用启动时，需要初始化熊猫互动系统：

```tsx
import { initializePandaInteraction } from '@/services/pandaInteractionService';

// 在组件中初始化
useEffect(() => {
  initializePandaInteraction();
}, []);
```

### 2. 使用熊猫互动面板

在需要显示熊猫互动面板的组件中，使用 `PandaInteractionPanel` 组件：

```tsx
import PandaInteractionPanel from '@/components/panda/PandaInteractionPanel';

// 在组件中使用
const [showInteractionPanel, setShowInteractionPanel] = useState(false);

// 处理互动完成
const handleInteractionComplete = (result) => {
  console.log('Interaction completed:', result);
};

// 在渲染中使用
return (
  <div>
    {/* 其他内容 */}
    <PandaInteractionPanel
      isOpen={showInteractionPanel}
      onClose={() => setShowInteractionPanel(false)}
      onInteractionComplete={handleInteractionComplete}
    />
  </div>
);
```

### 3. 使用熊猫动画组件

在需要显示熊猫动画的组件中，使用 `PandaAnimation` 组件：

```tsx
import PandaAnimation from '@/components/game/PandaAnimation';

// 在组件中使用
return (
  <div>
    {/* 其他内容 */}
    <PandaAnimation
      type="idle"
      mood="normal"
      energy="medium"
      size={150}
      loop={true}
      autoPlay={true}
      onClick={handleClick}
    />
  </div>
);
```

### 4. 直接使用熊猫互动服务

在需要直接与熊猫互动的组件中，使用 `performInteraction` 函数：

```tsx
import { performInteraction, InteractionType } from '@/services/pandaInteractionService';

// 在组件中使用
const handleInteraction = async () => {
  try {
    const result = await performInteraction(InteractionType.PET);
    console.log('Interaction result:', result);
  } catch (error) {
    console.error('Interaction failed:', error);
  }
};
```

## 示例页面

PandaHabit 应用提供了一个熊猫互动示例页面，用于展示各种熊猫互动和动画效果。可以通过访问 `/panda-interaction` 路径查看。

在这个页面上，你可以：

1. 查看各种熊猫动画效果
2. 尝试不同的互动类型
3. 查看互动结果和效果
4. 了解熊猫状态的变化

## 最佳实践

1. **适当使用互动**：不要过度使用互动，尊重冷却时间，提供更自然的用户体验。
2. **提供反馈**：为用户的互动提供明确的反馈，包括视觉和听觉反馈。
3. **保持一致性**：在整个应用中保持一致的互动体验和视觉风格。
4. **考虑性能**：在低端设备上，可能需要减少动画效果和粒子效果，以提高性能。
5. **多语言支持**：确保所有文本内容都支持多语言，使用 `useLocalizedView` 钩子获取本地化内容。

## 未来计划

1. **更多互动类型**：添加更多互动类型，如装扮、旅行等。
2. **互动任务系统**：添加与互动相关的任务，鼓励用户与熊猫互动。
3. **社交分享**：允许用户分享与熊猫的互动和照片。
4. **季节性互动**：根据季节和节日提供特殊的互动。
5. **熊猫成长系统**：基于互动历史和经验值，实现熊猫的成长和进化。
